# QuestHelper - рабочее название проекта GoSh!
**Цели проекта:**
- Дать возможность пользователю отметить интересные места, с фото и текстовым описанием
- Опубликовать собранные данные друзьям для просмотра и совместного редактирования

Небольшое описание в статье:
https://habr.com/ru/post/458272/

Приложение в Google Play:
https://play.google.com/store/apps/details?id=com.sd.gosh&hl=ru

Endpoint backend:
http://igosh.pro/api

**Структура солюшена:**
- Проект QuestHelper.Server. Основной проект для сборки сервера на базе WebApi .Net Core 2.1
- Проект QuestHelper.SharedModelsWS. Проект с моделями контрактов, общими для API и клиента.
- Проект QuestHelperServer.Tests. Юнит-тесты для серверной части.

Проекты сборки клиентского приложения вынесены в отдельный репозиторий:
https://github.com/gromozeka07b9/QuestHelper

**Работа с API:**
Примеры работы с API находятся в корне репозитория в каталоге Postman в соответствующем формате.

API представлено в виде публичной части и приватной.
* http://igosh.pro/api/v2/public/ - публичные запросы, используются для получения данных сайтом для отображения общедоступных данных.
* http://igosh.pro/api/ - приватные запросы, для получения/обновления/создания данных по личным маршрутам (не опубликованным)

Для выполнения запросов к публичной части API авторизация не требуется.
Для выполнения запросов к личной части требуется авторизоваться, в дальнейшем запросы будут выполняться в контексте учетной записи.
Например, метод создания маршрута приведет к созданию от имени той учетной записи, под которой произошла авторизация.

**Авторизация:**
- Первым делом надо завести себе учетку в GoSh!, можно зарегистрировать в приложении (пока что НЕ используя Google!).
- После того, как учетка появится, нужно вызвать метод API POST http://{{hostname}}/api/account
Content-Type: application/json
Body:
{
  "Username": "Имя пользователя в GoSh!",
  "Password": "Пароль, соответственно"
}
В результате запроса получите response, в котором в поле "access_token" будет тот Bearer-токен, который в дальнейшем нужно использовать при каждом запросе к API.
С этим токеном уже можно выполнять запросы к приватной части API.
К примеру, метод GET http://{{hostname}}/api/feed - возвращает ленту маршрутов, доступную конкретному пользователю, который определяется по переданному токену.

**Основы работы с данными:**
* Все данные в Gosh версионированы. Это необходимое условие для работы синхронизации. Версия объекта (например маршрута или точки маршрута) увеличивается при каждом изменении объекта. Например, при изменении свойств маршрута в мобильном приложении версия увеличивается, при запуске методов синхронизации с сервером версия проверяется, и если на сервере версия меньше чем на клиенте (в приложении) - маршрут на сервере загружается из приложения. В противном случае, если версия в приложении меньше, чем на сервере - считаем, что маршрут в приложении устарел, и он обновляется данными сервера. Если же версии идентичны - считаем маршрут синхронизированным.
* Версии есть не только у маршрутов (Route), но так же у точки маршрута (RoutePoint), медиаобъекта (RoutePointMediaObject), точки интереса для карты (POI)
* RoutePointMediaObject хранит ссылку на медиа-файл, которым может быть Image, Audio, Video. Для Image на сервере хранится два файла - оригинал и preview, именование в формате:
  * img_GUID.jpg - оригинал
  * img_GUID_preview.jpg - превью

# Последовательность работы с API по маршрутам.
Все примеры находятся в проекте Postman.

**Получение данных.**
Пример получения публичных маршрутов (Route all в Postman):
http://{{hostname}}/api/v2/public/routes?pageSize=100&range=[0,9]&filter={"name":"2019"}
В качестве параметров передаем:
* pageSize - размер порции данных
* range - диапазон страниц
* filter - ключ-значение с фильтрами. В примере фильтр по названию маршрута - поиск по like %2019%
Возвращается список объектов Route, удовлетворяющих условию.


Добавление новых маршрутов и точек с фото.
